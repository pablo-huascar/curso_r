---
title: "R para análise de dados em Psicologia"
subtitle: "Uma Introdução"
execute:
  echo: true
author: "Francisco Pablo Huascar Aragão Pinheiro"
institute: <img src="images/ufc_horizontal.png" width="250">
format: 
  revealjs:
      theme: simple
      fig-width: 6
      fig-asp: 0.618
      scrollable: true
progress: true
slide-number: true
logo: images/lappsie.png
editor: visual
editor_options: 
  chunk_output_type: console
---

## Quem sou eu

::: {style="line-height: 1;"}
::: columns
::: {.column width="40%"}
![](images/logo_pos.png) ![](images/lappsie.png)
:::

::: {.column width="60%"}
::: incremental
-   [Psicólogo]{style="font-size:25pt;"}
-   [Doutor em educação]{style="font-size:25pt;"}
-   [Professor do campus Sobral da UFC]{style="font-size:25pt;"}
-   [Recentemente, um entusiasta do R]{style="font-size:25pt;"}
:::
:::
:::
:::

::: aside
Meu [currículo lattes](http://lattes.cnpq.br/8266089190930601): acesse [aqui](http://lattes.cnpq.br/8266089190930601)
:::

# Regressão

## Pacotes utilizados

```{r}
#| label: setup
#| warning: false
#| message: false

library(tidyverse)
library(kableExtra)
library(GGally)
library(tidymodels)
```

## Obtenção do banco de dados

```{r}
#| label: dados
#| include: false
df <- 
  read_csv("./data/contexto_sm.csv")

```

```{r}
#| eval: false

df <- 
  read_csv("https://tinyurl.com/contextosm")

```

## Uma olhada no banco de dados

```{r}
glimpse(df)
```

## Variáveis Compostas: Saúde Mental

```{r}
#| label: manipulação dos dados - VDs

df <- 
  df |>
  rowwise() |> 
  mutate(
    tmcs = sum(c_across(srq1:srq20)),
    ans = sum(c_across(a1:a7)),
    dep = sum(c_across(d1:d7)),
    est = sum(c_across(e1:e7))
  ) |> 
  ungroup()
```

## Variáveis Compostas: Contexto de Trabalho

```{r}
#| label: manipulação dos dados - VIs

df <- df |> 
  rowwise() |> 
  mutate(
    org = mean(c(ct1,ct4,ct7,ct8,
                      ct12,ct13,ct14,ct17,
                      ct19,ct21,ct22,ct23,
                      ct24,ct30,ct37)),
    cond = mean(c(ct9,ct16,ct18,ct20,
                       ct26,ct33,ct36,ct38)),
    rel = mean(c(ct5,ct6,ct10,ct11,
                       ct15,ct27,ct29,ct32,
                       ct35,ct39))
  ) |> 
  ungroup()

```

## Usos da Regressão

-   Examinar o efeito de diferentes variáveis (preditoras / independentes) em uma única variável de resultado (dependente)

-   O uso o termo predição é essencial, pois a análise examina se uma variável prediz (explica ou repercute) outra variável

## Simulação da Linha de Regressão 

```{r}
#| label: tibble para regline

x <- c(0,1,2,3,4)

y <- 2 + 2*x

reg_line <- tibble(x,y)
```

## A Linha de Regressão

```{r}
#| label: linha de regressão
#| fig-align: center
#| fig-dpi: 600
#| output-location: slide

reg_line |> 
  ggplot(aes(x,y)) +
  geom_point() +
  geom_smooth(method = "lm",
              se = F) +
  theme_classic()

```

## A Linha de Regressão

```{r}
#| echo: false

reg_line |> 
  kable() |> 
  kable_classic_2()
```

## A linha de regressão

$$
y = a + bx
$$

-   y = VI
-   x = VD
-   a = constante (local onde a linha intercepta o eixo y)
-   b = inclinação da linha (cada vez que "x" aumenta 1 unidade, "y" aumenta "b" unidades)

## A Linha de Regressão

```{r}
#| echo: false
reg_line |> 
  kable() |> 
  kable_classic_2()
```

## Regressão Linear Simples

-   Correlação: magnitude e direção
-   Descobrir o tamanho do efeito de uma variável x (independente, previsora ou explicativa) em uma variável y (dependente, critério ou desfecho)
-   Quanto a pontuação em TMCs pode variar em função da organização do trabalho?
-   Quanto a pontuação em TMCs pode variar em função do pertencimento ao grupo de risco para covid-19?

## Regressão Linear Simples: Uma Variável Independente Contínua

-   Quanto a pontuação em TMCs pode variar em função da organização do trabalho?

## Análise de Dados Exploratória

-   ::: {style="font-size:26pt;line-height:1;"}
    -   Estatística descritiva

        -   Valores ausentes
        -   Mínimo
        -   Máximo
        -   Média
        -   Desvio padrão
        -   Histogramas

    -   Correlações

        -   Bivariadas
        -   Gráficos de dispersão
    :::

## Análise de Dados Exploratória: Uma Olhada nos Dados {.smaller}

```{r}
#| output-location: slide
df |>
  select(org, tmcs) |> 
  slice_head(n = 10) |> 
  kable(digits = 2) |> 
  kable_classic_2()
```

## Análise de Dados Exploratória: Estatísticas Univariadas {.smaller}

```{r}
#| echo: true
#| output-location: slide

df |>
  summarise(across(c(tmcs,org),
                   list("M" = mean,
                        "DP" = sd,
                        "MIN" = min,
                        "MAX" = max))) |>
  pivot_longer(cols = everything(),
               names_to = c("var", ".value"),
               names_sep = "_") |>
  rename("Variável" = var) |> 
  kable(digits = 2) |>
  kable_classic_2() |> 
  kable_styling(html_font = "Open Sans")
```

## Análise de Dados Exploratória: Estatísticas Univariadas {.smaller}

```{r}
#| label: histograma - organização do trabalho
#| fig-align: center
#| out-width: 65%
#| fig-dpi: 600
#| output-location: slide
df |> 
  ggplot(aes(org)) +
  geom_histogram(fill = "white",
                 color = "gray") +
  labs(y = NULL,
       x = "Organização do Trabalho") +
  theme_classic()
```

## Análise de Dados Exploratória: Estatísticas Univariadas {.smaller}

```{r}
#| label: histograma - tmcs
#| fig-align: center
#| out-width: 65%
#| fig-dpi: 600
#| output-location: slide

df |> 
  ggplot(aes(tmcs)) +
  geom_histogram(fill = "white",
                 color = "gray") +
  labs(y = NULL,
       x = "TMCs") +
  theme_classic()


```

## Análise de Dados Exploratória: Estatísticas Bivariadas {.smaller}

-   2 variáveis numéricas
    -   Coeficiente de Correlação

## Análise de Dados Exploratória: Estatísticas Bivariadas {.smaller}

```{r}
#| output-location: slide
cor <- df |> 
  select(org,tmcs) |> 
  psych::corr.test()

cor$stars |> 
  kable() |> 
  kable_classic_2(html_font = "Open Sans") |> 
  add_footnote("*** p < .001",notation = "none")
```

## Análise de Dados Exploratória: Estatísticas Bivariadas {.smaller}

```{r}
#| out-width: 70%
#| output-location: slide
df |> 
  select(org,tmcs) |> 
  ggpairs(lower = list(continuous = "smooth", 
                       wrap = c(method = "loess", fill = "blue", se = T))) +
  theme_classic()+
  theme(strip.background = element_blank())
  
```

## Análise de Dados Exploratória: Estatísticas Bivariadas {.smaller}

```{r}
#| out-width: 60%
#| output-location: slide
df |> 
  ggplot(aes(org,tmcs)) +
  geom_jitter() +
  geom_smooth(method = "lm",
              se = F,
              color = "red") +
  labs(x = "Organização do Trabalho",
       y = "Transtornos Mentais Comuns") +
  theme_classic()
  
```

## Regressão Linear Simples

[$$
y = a + bx
$$]{style="text-align: left"}

-   A partir do gráfico, o que sabemos até agora sobre entre TMCs e a organização do trabalho?
-   O que podemos dizer sobre a nossa equação?
    -   b tem uma inclinação positiva!
    -   Pessoas com piores avaliações da organização do trabalho (escores mais altos) tendem a ter piores índices nos TMCs (pontuações maiores)

## Regressão Linear Simples

$$
y = a + bx
$$

-   Qual o valor numérico para a incliação (slope) *b*?
-   E o valor do intercepto *a*?
-   Vamos utilizar a regressão linear simples para obter essas respostas

## Regressão Linear Simples

Notação da regressão:

-   "\~"

-   Vd \~ Vi1 + Vi2 + Vin

```{r}

fit_cont <- lm(tmcs ~ org, 
               data = df) 

```

## Tabela de Regressão

```{r}
#| output-location: slide
fit_cont |> 
  tidy() |> 
  mutate(
    across(where(is.double),
                ~ round(.,2))
    ) |>
  mutate(
    p.value = case_when(p.value == 0 ~ "< .001")
  ) |> 
  rename("Preditor" = term,
         "Estimativas" = estimate,
         "Erro-padrão" = std.error,
         "t" = statistic,
         "p" = p.value) |> 
  kable(align = ("lcccc")) |>
  kable_styling(font_size = 36) |> 
  kable_classic_2(html_font = "Open Sans") 

```

## Interpretando a Tabela de Regressão {.smaller}

```{r}
#| echo: false
fit_cont |> 
  tidy() |> 
  mutate(
    across(where(is.double),
                ~ round(.,2))
    ) |>
  mutate(
    p.value = case_when(p.value == 0 ~ "< .001")
  ) |> 
  rename("Preditor" = term,
         "Estimativas" = estimate,
         "Erro-padrão" = std.error,
         "t" = statistic,
         "p" = p.value) |> 
  kable(align = ("lcccc")) |>
  kable_styling(font_size = 36) |> 
  kable_classic_2(html_font = "Open Sans") 

```


$$
y = a + bx
$$

-   Estimativas
    -   a = Estimativa do Intercepto = -2.57
    -   b = Estimativa da `org` = 2.50

$$
tmcs = -2.57 + 2.50org
$$

::: aside
Enquanto o intercepto da linha de regressão tem uma interpretação matemática, ela não tem nenhuma interpretação prática, pois observar um valor de `org` igual a 0 é impossível
:::

## Interpretando a Tabela de Regressão {.smaller}

```{r}
#| echo: false
fit_cont |> 
  tidy() |> 
  mutate(
    across(where(is.double),
                ~ round(.,2))
    ) |>
  mutate(
    p.value = case_when(p.value == 0 ~ "< .001")
  ) |> 
  rename("Preditor" = term,
         "Estimativas" = estimate,
         "Erro-padrão" = std.error,
         "t" = statistic,
         "p" = p.value) |> 
  kable(align = ("lcccc")) |>
  kable_styling(font_size = 36) |> 
  kable_classic_2(html_font = "Open Sans") 

```


$$
tmcs = -2.57 + 2.50org
$$

-   Quais conclusões podemos tirar dessa equação?
    -   O sinal é positivo, portanto há uma relação positiva entre as variáveis
        -   Quanto maior a pontuação em `org` maior a pontuação em `tmcs`
        - Ou seja: piores avaliações da organização do trabalho estão associados a maiores prejuízos a saúde mental
    -   Interpretação do valor de b (estimativa de `org`):
        -   Para cada aumento de 1 unidade em `org`, há um aumento associado de, em média, 2.50 unidades de `tmcs`

## Valores Observados/Ajustados e os Resíduos

$$
tmcs = -2.57 + 2.50org
$$
```{r}
#| echo: false
df |> 
  select(tmcs,org) |> 
  slice(15) |>
  mutate(id = 15,
         .before = tmcs) |> 
  kable(digits = 3) |> 
  kable_styling(font_size = 36) |> 
  kable_classic_2(html_font = "Open Sans")
```



-   Valor observado dos tmcs = 4
-   Valor ajustado/previsto = 4.598

$$
tmcs = -2.57 + 2.50*2.867 = 4.598
$$

- Resíduos: a diferença entre o que foi ajustado/previsto e o valor observado

$$
resíduo = 4 - 4.598 = -0.598
$$

## Valores Observados/Ajustados e os Resíduos

```{r}
#| include: false
fit_cont |> 
  augment() |>
  filter(tmcs == 20)
```


```{r}
#| out-width: 55%
#| output-location: slide

df |> 
  ggplot(aes(org,tmcs)) +
  geom_point() +
  geom_smooth(method = "lm",
              se = F,
              color = "red") +
  labs(x = "Organização do Trabalho",
       y = "Transtornos Mentais Comuns") +
  theme_classic()+
  geom_segment(aes(x = 2.867, y = 4, 
                   xend = 2.867, yend = 4.598), 
               color = "blue")+
  geom_segment(aes(x = 4.07, y = 20,
                   xend = 4.07, yend = 7.59),
               color = "blue")
  
```

## Valores Observados/Ajustados e os Resíduos

```{r}
#| output-location: slide
fit_cont |> 
  augment() |> 
  select(tmcs:.resid) |>
  mutate(ID = 1:nrow(df),
         .before = tmcs) |> 
  slice_head(n = 10) |> 
  mutate(across(.fitted:.resid,
                ~ round(.,3))) |>
  kable(align = ("ccccc")) |> 
  kable_styling(font_size = 22) |> 
  kable_classic_2(html_font = "Open Sans")
```

## Regressão Linear Simples: Uma Variável Independente Categórica

Quanto a pontuação em TMCs pode variar em função do pertencimento ao grupo de risco para covid-19?

## Análise de Dados Exploratória

-   ::: {style="font-size:26pt;line-height:1;"}
    -   Estatística descritiva

        -   Valores ausentes
        -   Mínimo
        -   Máximo
        -   Média
        -   Desvio padrão
        -   Box Plot
        -   Tabelas de frequência
        -   Comparação entre médias/medianas

    :::

## Análise de Dados Exploratória: Uma Olhada nos Dados

```{r}
#| output-location: slide

df |> 
  select(tmcs, grupo_de_risco) |> 
  slice_head(n = 10) |> 
  kable(digits = 2) |>
  kable_styling(font_size = 22,full_width = F) |> 
  kable_classic_2(html_font = "Open Sans")
```

## Análise de Dados Exploratória: Estatísticas Univariadas {.smaller}

```{r}
#| echo: true
#| output-location: slide

df |>
  summarise(across(c(tmcs),
                   list("M" = mean,
                        "DP" = sd,
                        "MIN" = min,
                        "MAX" = max))) |>
  pivot_longer(cols = everything(),
               names_to = c("var", ".value"),
               names_sep = "_") |>
  rename("Variável" = var) |> 
  kable(digits = 2) |>
  kable_classic_2() |> 
  kable_styling(html_font = "Open Sans")
```

## Análise de Dados Exploratória: Estatísticas Univariadas {.smaller}

```{r}
#| fig-align: center
#| out-width: 65%
#| fig-dpi: 600
#| output-location: slide
df |> 
  ggplot(aes(tmcs)) +
  geom_histogram(fill = "white",
                 color = "gray") +
  labs(y = NULL,
       x = "TMCs") +
  theme_classic()
```

## Análise de Dados Exploratória: Tabelas de Frequência

```{r}
#| output-location: slide
df |> 
  count(grupo_de_risco) |> 
  mutate("% do Total"  = (n/sum(n))*100,
         "% acumulada"  = cumsum((n/sum(n))*100)) |> 
  rename("Contagens" = n) |>
  kable() |> 
  kable_classic_2() |> 
  kable_styling(html_font = "Open Sans",
                font_size = 30)
```

## Comparação entre Grupos

```{r}
#| output-location: slide
#| out-width: 70%
#| fig-align: center
#| fig-dpi: 600
df |> 
  ggplot(aes(grupo_de_risco,tmcs))+
  geom_boxplot() +
  geom_jitter(aes(grupo_de_risco),
              alpha = 0.1,
              size = 1.5,
              color = "blue") +
  labs(x = "Grupo de Risco para covid-19",
       y = "TMCs") +
  theme_classic()
```

## Resultados entre Grupos

```{r}
#| output-location: slide

jmv::descriptives(
    formula = tmcs ~ grupo_de_risco,
    data = df,
    desc = "rows",
    min = FALSE,
    max = FALSE)
  
```

## Diferenças Entre as Médias

```{r}
teste <- 
  df |>
  group_by(grupo_de_risco) |> 
  summarise(M = mean(tmcs))
            
teste |> 
  mutate("Diferença entre as médias" = M - teste$M[teste$grupo_de_risco == "Não"]) |> 
  kable(digits = 1) |> 
  kable_classic_2() |> 
  kable_styling(html_font = "Open Sans")

```

## Regressão Linear Simples

```{r}
fit_cat <- lm(tmcs ~ grupo_de_risco,
   data = df) 
```

## Tabela de Regressão

```{r}
#| output-location: slide

fit_cat |>
  tidy() |> 
  mutate(
    across(where(is.double),
                ~ round(.,2))
    ) |>
  mutate(
    p.value = case_when(p.value == 0 ~ "< .001")
  ) |> 
  rename("Preditor" = term,
         "Estimativas" = estimate,
         "Erro-padrão" = std.error,
         "t" = statistic,
         "p" = p.value) |> 
  kable(align = ("lcccc")) |>
  kable_styling(font_size = 36) |> 
  kable_classic_2(html_font = "Open Sans") 
```


